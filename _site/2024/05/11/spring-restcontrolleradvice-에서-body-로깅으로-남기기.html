<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="[Spring] @RestControllerAdviceì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°" /><meta name="author" content="ê¹€ë¯¼ì‹" /><meta property="og:locale" content="en_US" /><meta name="description" content="@RestControllerAdviceì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ HttpServletRequestì˜ bodyë¥¼ ë¡œê¹…í•˜ë ¤ í•  ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤. InputStreamì´ í•œ ë²ˆë§Œ ì½ì„ ìˆ˜ ìˆëŠ” ì´ìœ ë¥¼ ì„¤ëª…í•˜ê³ , ContentCachingRequestWrapperì™€ ì»¤ìŠ¤í…€ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤." /><meta property="og:description" content="@RestControllerAdviceì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ HttpServletRequestì˜ bodyë¥¼ ë¡œê¹…í•˜ë ¤ í•  ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤. InputStreamì´ í•œ ë²ˆë§Œ ì½ì„ ìˆ˜ ìˆëŠ” ì´ìœ ë¥¼ ì„¤ëª…í•˜ê³ , ContentCachingRequestWrapperì™€ ì»¤ìŠ¤í…€ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤." /><link rel="canonical" href="http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0" /><meta property="og:url" content="http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0" /><meta property="og:site_name" content="ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-11T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Spring] @RestControllerAdviceì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ê¹€ë¯¼ì‹","url":"https://minshikkim.com"},"dateModified":"2024-05-11T00:00:00+09:00","datePublished":"2024-05-11T00:00:00+09:00","description":"@RestControllerAdviceì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ HttpServletRequestì˜ bodyë¥¼ ë¡œê¹…í•˜ë ¤ í•  ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤. InputStreamì´ í•œ ë²ˆë§Œ ì½ì„ ìˆ˜ ìˆëŠ” ì´ìœ ë¥¼ ì„¤ëª…í•˜ê³ , ContentCachingRequestWrapperì™€ ì»¤ìŠ¤í…€ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤.","headline":"[Spring] @RestControllerAdviceì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0"},"url":"http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0"}</script><title> [Spring] @RestControllerAdviceì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸° - ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸</title><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸" href="/atom.xml"><link rel="alternate" type="application/json" title="ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /> <script src="https://cdn.jsdelivr.net/npm/mermaid@11.9.0/dist/mermaid.min.js"></script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:Inter,SF Pro,Segoe UI,Roboto,Oxygen,Ubuntu,Helvetica Neue,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.7;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:2.5rem 0 1rem 0}.post ul,.post ol{margin-left:1.5rem}.post table{border:1px solid gray;border-collapse:collapse}.post table td,.post table th{border:1px solid gray;padding:.5rem 1rem}.post table th{white-space:nowrap}.meta{margin:2rem 0}.meta p{margin:0}.meta time{display:block;margin-bottom:.5rem}.highlight code,pre{background:#fafafa}.highlight code{padding:.1rem}h1>code,h2>code,h3>code,h4>code,h5>code,h6>code,li>code,p>code{background-color:rgba(129,139,152,.1215686275);padding:2px 4px;border-radius:6px}pre.mermaid{background:none}pre.mermaid>*{background:inherit}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0;margin:1.5rem 0 2rem}header{flex-basis:10rem;flex-grow:1;position:relative}header>nav:first-child{margin-bottom:2rem}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{border-left:5px solid #ececec;padding-left:1rem;margin:1rem 0}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{font-size:2.125em;font-weight:800;margin-top:0;margin-bottom:.5em;line-height:1.5}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}.pagination{margin-top:1.5rem;display:flex;align-items:center;gap:1rem;margin-left:auto}.pagination .page_number{margin-right:1rem}.pagination .page_number .current{font-weight:bold}.pagination img{width:24px;height:24px;display:block;padding:4px}.pagination img.disabled{opacity:.3}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:0 auto 2rem auto;padding:1rem}.title{margin:2rem auto 0 auto;max-width:60rem;padding-left:12rem;font-size:24px}.title a{text-decoration:none;font-weight:bold}.post a{overflow-wrap:break-word}.post li{margin-top:.25rem;margin-bottom:.25rem}.post iframe{max-width:100%}.mobile{display:none}@media screen and (max-width: 45rem){header{display:none}header.active{display:block;position:fixed;left:0;top:0;background:#fff;width:100%;height:100%;padding:2rem}header ul{border-right:none}header li{text-align:left;margin-right:0}header li>a{display:block;padding:.25rem 0}.logo{padding-bottom:1rem}.photos ul{margin-top:.5rem}.title{margin:2rem auto 0;padding:0;text-align:center}.mobile{display:flex}.mobile.menu-button{position:absolute;padding:.25rem;margin-left:1.5rem;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mobile.close-button{position:absolute;right:1.5rem;top:2rem;padding:.25rem;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0)}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}section.post .toc{border:1px solid #ccc;font-size:15px;margin:1rem 0 1.5rem}section.post .toc a{text-decoration:none}section.post .table-wrapper{overflow-x:auto;padding-bottom:1rem}figcaption{font-size:smaller}@media print{.no-print,.no-print *{display:none !important}}.content{--content-heading-weight: var(--weight-extrabold);--content-heading-line-height: 1.125;--content-block-margin-bottom: 1em;--content-blockquote-padding: 0.5em 1.5em;--content-pre-padding: 1.25em 1.5em;--content-table-cell-border-width: 0 0 1px;--content-table-cell-padding: 0.5em 0.75em;--content-table-head-cell-border-width: 0 0 2px;--content-table-body-last-row-cell-border-bottom-width: 0;--content-table-foot-cell-border-width: 2px 0 0}.content li+li{margin-top:.25em}.content p:not(:last-child),.content dl:not(:last-child),.content ol:not(:last-child),.content ul:not(:last-child),.content blockquote:not(:last-child),.content pre:not(:last-child),.content table:not(:last-child){margin-bottom:var(--content-block-margin-bottom)}.content h1,.content h2,.content h3,.content h4,.content h5,.content h6{font-weight:var(--content-heading-weight);line-height:var(--content-heading-line-height)}.content h1{font-size:2em;margin-bottom:.5em}.content h1:not(:first-child){margin-top:1em}.content h2{font-size:1.75em;margin-bottom:.5714em}.content h2:not(:first-child){margin-top:1.1428em}.content h3{font-size:1.5em;margin-bottom:.6666em}.content h3:not(:first-child){margin-top:1.3333em}.content h4{font-size:1.25em;margin-bottom:.8em}.content h5{font-size:1.125em;margin-bottom:.8888em}.content h6{font-size:1em;margin-bottom:1em}.content blockquote{padding:var(--content-blockquote-padding)}.content ol{list-style-position:outside;margin-inline-start:2em}.content ol:not(:first-child){margin-top:1em}.content ol:not([type]){list-style-type:decimal}.content ol:not([type]).is-lower-alpha{list-style-type:lower-alpha}.content ol:not([type]).is-lower-roman{list-style-type:lower-roman}.content ol:not([type]).is-upper-alpha{list-style-type:upper-alpha}.content ol:not([type]).is-upper-roman{list-style-type:upper-roman}.content ul{list-style:disc outside;margin-inline-start:2em}.content ul:not(:first-child){margin-top:1em}.content ul ul{list-style-type:circle;margin-bottom:.25em;margin-top:.25em}.content ul ul ul{list-style-type:square}.content dd{margin-inline-start:2em}.content figure:not([class]){margin-left:2em;margin-right:2em;text-align:center}.content figure:not([class]):not(:first-child){margin-top:2em}.content figure:not([class]):not(:last-child){margin-bottom:2em}.content figure:not([class]) img{display:inline-block}.content figure:not([class]) figcaption{font-style:italic}.content pre{-webkit-overflow-scrolling:touch;overflow-x:auto;padding:var(--content-pre-padding);white-space:pre;word-wrap:normal}.content sup,.content sub{font-size:75%}.content table td,.content table th{border-width:var(--content-table-cell-border-width);padding:var(--content-table-cell-padding);vertical-align:top}.content table th:not([align]){text-align:inherit}.content table thead td,.content table thead th{border-width:var(--content-table-head-cell-border-width)}.content table tfoot td,.content table tfoot th{border-width:var(--content-table-foot-cell-border-width)}.content table tbody tr:last-child td,.content table tbody tr:last-child th{border-bottom-width:var(--content-table-body-last-row-cell-border-bottom-width)}.content .tabs li+li{margin-top:0}.content.is-small{font-size:var(--size-small)}.content.is-normal{font-size:var(--size-normal)}.content.is-medium{font-size:var(--size-medium)}.content.is-large{font-size:var(--size-large)}:root{--weight-light: 300;--weight-normal: 400;--weight-medium: 500;--weight-semibold: 600;--weight-bold: 700;--weight-extrabold: 800}</style><script async src="https://www.googletagmanager.com/gtag/js?id=UA-150864545-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-150864545-1'); </script></head><body><div class="title"> <a href="/">ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸</a></div><main role="main"><header role="banner"><nav role="navigation"><ul><li><a href="/" >Posts</a></li><li><a href="/categories" >Categories</a></li><li><a href="/tags" >Tags</a></li><li><a href="/search" >Search</a></li></ul></nav></header><section class="post"><h1>[Spring] @RestControllerAdviceì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°</h1><div class="toc"><ol id="toc" class="section-nav"><li class="toc-entry toc-h1"><a href="#20240511-----restcontrolleradvice-ì—ì„œ-body-ë¡œê¹…ìœ¼ë¡œ-ë‚¨ê¸°ê¸°md">2024.05.11 - ğŸŒ± @RestControllerAdvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°.md</a><ol><li class="toc-entry toc-h2"><a href="#ì‚¬ê±´ì˜-ë°œë‹¨">ì‚¬ê±´ì˜ ë°œë‹¨</a></li><li class="toc-entry toc-h2"><a href="#httpservletrequest-ì—ì„œ-ê°’ì„-ì½ì„-ë•ŒëŠ”-ë‚´ë¶€ì ìœ¼ë¡œ-inputstream-ì„-ì‚¬ìš©í•œë‹¤">HttpServletRequest ì—ì„œ ê°’ì„ ì½ì„ ë•ŒëŠ” ë‚´ë¶€ì ìœ¼ë¡œ InputStream ì„ ì‚¬ìš©í•œë‹¤.</a></li><li class="toc-entry toc-h2"><a href="#contentcachingrequestwrapper">ContentCachingRequestWrapper</a></li><li class="toc-entry toc-h2"><a href="#ì ìš©">ì ìš©</a><ol><li class="toc-entry toc-h3"><a href="#ì°¸ê³ ">ì°¸ê³ </a></li></ol></li></ol></li></ol></div><div class="content"><h1 id="20240511-----restcontrolleradvice-ì—ì„œ-body-ë¡œê¹…ìœ¼ë¡œ-ë‚¨ê¸°ê¸°md">2024.05.11 - ğŸŒ± @RestControllerAdvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°.md</h1><h2 id="ì‚¬ê±´ì˜-ë°œë‹¨">ì‚¬ê±´ì˜ ë°œë‹¨</h2><p>í˜„ì¬ ì§„í–‰í•˜ê³  ìˆëŠ” í”„ë¡œì íŠ¸ì—ì„œëŠ” @RestControllerAdvice ë¥¼ ì´ìš©í•˜ì—¬ ì˜ˆì™¸ë¥¼ ì „ì—­ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.<br /> ì˜ˆì™¸ê°€ ë‚¬ì„ ë•Œ ì–´ë–¤ ìš”ì²­ê°’ì´ ë“¤ì–´ì™€ì„œ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ” ì§€ ë¡œê·¸ë¡œ ë‚¨ê¸°ê³  ì‹¶ì–´ì„œ request ì˜ body ë¥¼ ì½ê³  ì‹¶ì—ˆìœ¼ë‚˜ ì•„ë¬´ëŸ° ê°’ì´ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="syntax"><code>
<span class="nd">@Slf4j</span>
<span class="nd">@RestControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalExceptionHandler</span> <span class="o">{</span>

  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">HotelkingException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">ErrorContent</span><span class="o">&gt;&gt;</span> <span class="nf">handleHotelkingException</span><span class="o">(</span>
      <span class="nc">HotelkingException</span> <span class="n">e</span><span class="o">,</span>
      <span class="nc">HttpServletRequest</span> <span class="n">request</span>
  <span class="o">){</span>
    <span class="nc">ErrorCode</span> <span class="n">ec</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">();</span>
<span class="nc">String</span> <span class="n">body</span> <span class="o">=</span> <span class="nc">StreamUtils</span><span class="o">.</span><span class="na">copyToString</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"body = {}"</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span> <span class="c1">// ìŠ¬í”„ê²Œë„ ì•„ë¬´ê²ƒë„ ì•ˆë‚˜ì˜¨ë‹¤.</span>
    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">ec</span><span class="o">.</span><span class="na">getHttpStatus</span><span class="o">()).</span><span class="na">body</span><span class="o">(</span><span class="nc">ApiResponse</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="nc">ErrorContent</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">ec</span><span class="o">)));</span>
  <span class="o">}</span>

  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">HttpMessageNotReadableException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">ErrorContent</span><span class="o">&gt;&gt;</span> <span class="nf">handleHttpMessageNotReadableException</span><span class="o">(</span><span class="nc">HttpMessageNotReadableException</span> <span class="n">e</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ErrorCode</span> <span class="n">ec</span> <span class="o">=</span> <span class="nc">ErrorCode</span><span class="o">.</span><span class="na">NOT_READABLE</span><span class="o">;</span>
    <span class="n">printLog</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">ec</span><span class="o">);</span>
    <span class="k">return</span> <span class="nc">ResponseEntity</span>
        <span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">NOT_READABLE</span><span class="o">.</span><span class="na">getHttpStatus</span><span class="o">())</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="nc">ApiResponse</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="nc">ErrorContent</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">ec</span><span class="o">)));</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p>HttpServletRequest ì—ì„œ ë‹¤ì‹œ í•œë²ˆ InputStream ì„ ì´ìš©í•˜ì—¬ body ë¥¼ ì½ìœ¼ë ¤ê³  í–ˆì§€ë§Œ ì•„ë¬´ê²ƒë„ ì½ì„ ìˆ˜ ì—†ì—ˆë‹¤.</p><h2 id="httpservletrequest-ì—ì„œ-ê°’ì„-ì½ì„-ë•ŒëŠ”-ë‚´ë¶€ì ìœ¼ë¡œ-inputstream-ì„-ì‚¬ìš©í•œë‹¤">HttpServletRequest ì—ì„œ ê°’ì„ ì½ì„ ë•ŒëŠ” ë‚´ë¶€ì ìœ¼ë¡œ InputStream ì„ ì‚¬ìš©í•œë‹¤.</h2><blockquote><p>The spring-web module contains the HttpMessageConverter interface for reading and writing the body of HTTP requests and responses through InputStream and OutputStream. HttpMessageConverter instances are used on the client side (for concurrency, in the RestClient) and on the server side (for concurrency, in Spring MVC REST controllers).</p></blockquote><p><img src="https://velog.velcdn.com/images/kmss6905/post/bc215933-2cc6-43a4-9a7f-36dc13766dee/image.png" alt="" /></p><p>Spring MVC ëŠ” Servlet API ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤. Spring MVC ì—ì„œëŠ” Dispatcher Servlet ì´ ê·¸ ì—­í• ì„ ë‹´ë‹¹í•˜ê³  ìˆë‹¤. Http ìš”ì²­ì„ ë‹¤ë£° ë•Œ HttpServletRequest ì—ì„œ ìš”ì²­ body ë¥¼ ì½ì„ ë•Œ <code class="language-html highlighter-rouge">getInputStream()</code> ê·¸ë¦¬ê³  <code class="language-html highlighter-rouge">getReader()</code> ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤. ì´ëŸ¬í•œ ê° ë©”ì†Œë“œëŠ” ë™ì¼í•œ InputStream ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— InputStreamì„ í•œ ë²ˆ ì½ìœ¼ë©´ ë‹¤ì‹œ ì½ì„ ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆë‹¤.</p><h2 id="contentcachingrequestwrapper">ContentCachingRequestWrapper</h2><p><code class="language-html highlighter-rouge">ContentCachingRequestWrapper</code> ëŠ” ìƒì„±ìë¡œ ë°›ì€ HttpServeltRequest ë¥¼ input stream ê³¼ reader ë¡œ ë¶€í„° ëª¨ë“  HttpServletRequest ì»¨í…ì¸ ë¥¼ ìºì‹œí•˜ëŠ” HttpServlerRequest Wrapper í´ë˜ìŠ¤ì´ë‹¤.</p><p>ìºì‹œí•œ content ëŠ” byte array í˜•íƒœë¡œ ë‹¤ì‹œ ì–»ì„ ìˆ˜ ìˆë‹¤.</p><p>ì–»ì„ ë•ŒëŠ” <code class="language-html highlighter-rouge">getContentAsByteArray()</code> ë¥¼ í†µí•´ ë‹¤ì‹œ ì–»ì„ ìˆ˜ ìˆë‹¤.</p><p>ì¤‘ìš”í•œ ê±´ ìš”ì²­ ì»¨í…ì¸ ê°€ consumed ë˜ì§€ ì•Šì•˜ë‹¤ë©´, ì»¨í…ì¸ ëŠ” ìºì‹œë˜ì§€ ì•ŠëŠ”ë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="syntax"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContentCachingRequestWrapper</span> <span class="kd">extends</span> <span class="nc">HttpServletRequestWrapper</span> <span class="o">{</span>

<span class="kd">private</span> <span class="kd">final</span> <span class="nc">FastByteArrayOutputStream</span> <span class="n">cachedContent</span><span class="o">;</span>

<span class="kd">public</span> <span class="nf">ContentCachingRequestWrapper</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
		
		<span class="c1">// ìºì‹œ í•˜ëŠ” ë¶€ë¶„</span>
		<span class="kt">int</span> <span class="n">contentLength</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getContentLength</span><span class="o">();</span>
		
		<span class="c1">// content ê°€ ìˆëŠ” ê²½ìš° ìºì‹œí•œë‹¤.</span>
		<span class="k">this</span><span class="o">.</span><span class="na">cachedContent</span> <span class="o">=</span> <span class="o">(</span><span class="n">contentLength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">?</span> <span class="k">new</span> <span class="nc">FastByteArrayOutputStream</span><span class="o">(</span><span class="n">contentLength</span><span class="o">)</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">FastByteArrayOutputStream</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">contentCacheLimit</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="o">...</span>
	
	<span class="c1">// ìºì‹œí•œ ì»¨í…ì¸ ë¥¼ ê°€ì ¸ì˜¨ë‹¤.</span>
	<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContentAsByteArray</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cachedContent</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>ì—„ì²­ íŠ¹ì´í•œ ê±´ ì—†ë‹¤.</p><p>ë‹¤ë§Œ <code class="language-html highlighter-rouge">FastByteArrayOutputStream</code> ì´ë¼ê³  í•˜ëŠ” OutputStream ì„ extend í•˜ì—¬ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ë¬¸ì„œì—ì„œëŠ” ByteArrayOutputStream ì˜ ëŒ€ì•ˆìœ¼ë¡œ ë‚˜ì™”ë‹¤ê³  í•œë‹¤.</p><p>ì°¸ê³ ë¡œ <code class="language-html highlighter-rouge">AbstractRequestLoggingFilter</code> ì—ì„œë„ ìœ„ì˜ <code class="language-html highlighter-rouge">ContentCachingRequestWrapper</code> ê°€ ì‚¬ìš©ëœë‹¤.</p><p><img src="https://velog.velcdn.com/images/kmss6905/post/8eb4fafc-4f37-4855-9bb4-8a8bc838a0d5/image.png" alt="" /></p><h2 id="ì ìš©">ì ìš©</h2><p>Custom Filter ë¥¼ ë§Œë“¤ì–´ ê¸°ì¡´ HttpServletRequest ë¥¼ ìºì‹±í•  ìˆ˜ ìˆë„ë¡ ë“¤ì–´ì˜¨ HttpServletRequest ë¥¼ ì´ìš©í•˜ì—¬ ContentCachingRequestWrapper ê°ì²´ë¥¼ ë§Œë“  í›„ doFilterë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CachingFilter</span> <span class="kd">extends</span> <span class="nc">OncePerRequestFilter</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
      <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="k">new</span> <span class="nc">ContentCachingRequestWrapper</span><span class="o">(</span><span class="n">request</span><span class="o">),</span> <span class="n">response</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><h3 id="ì°¸ê³ ">ì°¸ê³ </h3><ul><li>https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-message-conversion</li></ul></div><div class="meta"> <time datetime="2024-05-11T00:00:00+09:00">May 11, 2024</time><p> categories: <a href="/category/Spring">Spring</a></p><p> tags: <a href="/tag/spring">spring</a> , <a href="/tag/spring boot">spring boot</a> , <a href="/tag/restcontrolleradvice">restcontrolleradvice</a> , <a href="/tag/filter">filter</a> , <a href="/tag/contentcachingrequestwrapper">contentcachingrequestwrapper</a> , <a href="/tag/logging">logging</a> , <a href="/tag/exception handling">exception handling</a></p></div><script> mermaid.initialize({startOnLoad:true}); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script></section></main></body></html>
