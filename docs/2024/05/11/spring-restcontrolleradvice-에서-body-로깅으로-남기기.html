<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="[spring] @restcontrolleradvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°" /><meta name="author" content="Colin Holzman" /><meta property="og:locale" content="en_US" /><meta name="description" content="2024.05.11 - ğŸŒ± @RestControllerAdvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°.md" /><meta property="og:description" content="2024.05.11 - ğŸŒ± @RestControllerAdvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°.md" /><link rel="canonical" href="http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0" /><meta property="og:url" content="http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0" /><meta property="og:site_name" content="ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-11T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[spring] @restcontrolleradvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@Colin Holzman" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Colin Holzman"},"dateModified":"2024-05-11T00:00:00+09:00","datePublished":"2024-05-11T00:00:00+09:00","description":"2024.05.11 - ğŸŒ± @RestControllerAdvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°.md","headline":"[spring] @restcontrolleradvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0"},"url":"http://localhost:4000/2024/05/11/spring-restcontrolleradvice-%EC%97%90%EC%84%9C-body-%EB%A1%9C%EA%B9%85%EC%9C%BC%EB%A1%9C-%EB%82%A8%EA%B8%B0%EA%B8%B0"}</script><title> [spring] @restcontrolleradvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸° - ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸</title><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸" href="/atom.xml"><link rel="alternate" type="application/json" title="ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0}body{font-family:-apple-system,BlinkMacSystemFont,"avenir next",avenir,helvetica,"helvetica neue",ubuntu,roboto,noto,"segoe ui",arial,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:.5rem}.posts ul,header ul{list-style:none;padding:0}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:0 auto 2rem auto;padding:1rem}.title{margin:2rem auto 0 auto;max-width:60rem;padding-left:12rem;font-size:24px}.title a{text-decoration:none;font-weight:bold}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}.section-nav{background-color:#fff;margin:5px 0;padding:10px 30px;border:1px solid #e8e8e8;border-radius:3px}figcaption{font-size:smaller}.pagination{margin-top:1.5rem;display:flex;align-items:center;gap:1rem;margin-left:auto}.pagination .page_number{margin-right:1rem}.pagination .page_number .current{font-weight:bold}.pagination img{width:24px;height:24px;display:block;padding:4px}.pagination img.disabled{opacity:.3}</style><script async src="https://www.googletagmanager.com/gtag/js?id=UA-150864545-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-150864545-1'); </script></head><body><div class="title"> <a href="/">ê¹€ë¯¼ì‹ ê¸°ìˆ ë¸”ë¡œê·¸</a></div><main role="main"><header role="banner"><nav role="navigation"><ul><li><a href="/" >Posts</a></li><li><a href="/about" >About</a></li><li><a href="/resume" >Resume</a></li><li><a href="/search" >Search</a></li><li><a href="/atom.xml" >Rss</a></li></ul></nav></header><section class="post"><h2>[spring] @restcontrolleradvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°</h2><div class="toc"><ol id="toc" class="section-nav"><li class="toc-entry toc-h1"><a href="#20240511-----restcontrolleradvice-ì—ì„œ-body-ë¡œê¹…ìœ¼ë¡œ-ë‚¨ê¸°ê¸°md">2024.05.11 - ğŸŒ± @RestControllerAdvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°.md</a><ol><li class="toc-entry toc-h2"><a href="#ì‚¬ê±´ì˜-ë°œë‹¨">ì‚¬ê±´ì˜ ë°œë‹¨</a></li><li class="toc-entry toc-h2"><a href="#httpservletrequest-ì—ì„œ-ê°’ì„-ì½ì„-ë•ŒëŠ”-ë‚´ë¶€ì ìœ¼ë¡œ-inputstream-ì„-ì‚¬ìš©í•œë‹¤">HttpServletRequest ì—ì„œ ê°’ì„ ì½ì„ ë•ŒëŠ” ë‚´ë¶€ì ìœ¼ë¡œ InputStream ì„ ì‚¬ìš©í•œë‹¤.</a></li><li class="toc-entry toc-h2"><a href="#contentcachingrequestwrapper">ContentCachingRequestWrapper</a></li><li class="toc-entry toc-h2"><a href="#ì ìš©">ì ìš©</a><ol><li class="toc-entry toc-h3"><a href="#ì°¸ê³ ">ì°¸ê³ </a></li></ol></li></ol></li></ol></div><div class="content"><h1 id="20240511-----restcontrolleradvice-ì—ì„œ-body-ë¡œê¹…ìœ¼ë¡œ-ë‚¨ê¸°ê¸°md">2024.05.11 - ğŸŒ± @RestControllerAdvice ì—ì„œ body ë¡œê¹…ìœ¼ë¡œ ë‚¨ê¸°ê¸°.md</h1><h2 id="ì‚¬ê±´ì˜-ë°œë‹¨">ì‚¬ê±´ì˜ ë°œë‹¨</h2><p>í˜„ì¬ ì§„í–‰í•˜ê³  ìˆëŠ” í”„ë¡œì íŠ¸ì—ì„œëŠ” @RestControllerAdvice ë¥¼ ì´ìš©í•˜ì—¬ ì˜ˆì™¸ë¥¼ ì „ì—­ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.<br /> ì˜ˆì™¸ê°€ ë‚¬ì„ ë•Œ ì–´ë–¤ ìš”ì²­ê°’ì´ ë“¤ì–´ì™€ì„œ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ” ì§€ ë¡œê·¸ë¡œ ë‚¨ê¸°ê³  ì‹¶ì–´ì„œ request ì˜ body ë¥¼ ì½ê³  ì‹¶ì—ˆìœ¼ë‚˜ ì•„ë¬´ëŸ° ê°’ì´ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.</p><pre><code class="language-java">
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

  @ExceptionHandler(HotelkingException.class)
  public ResponseEntity&lt;ApiResponse&lt;ErrorContent&gt;&gt; handleHotelkingException(
      HotelkingException e,
      HttpServletRequest request
  ){
    ErrorCode ec = e.getErrorCode();
String body = StreamUtils.copyToString(request.getInputStream(), StandardCharsets.UTF_8);
log.error("body = {}", body); // ìŠ¬í”„ê²Œë„ ì•„ë¬´ê²ƒë„ ì•ˆë‚˜ì˜¨ë‹¤.
    return ResponseEntity.status(ec.getHttpStatus()).body(ApiResponse.error(ErrorContent.from(ec)));
  }

  @ExceptionHandler(HttpMessageNotReadableException.class)
  public ResponseEntity&lt;ApiResponse&lt;ErrorContent&gt;&gt; handleHttpMessageNotReadableException(HttpMessageNotReadableException e, HttpServletRequest request) {
    ErrorCode ec = ErrorCode.NOT_READABLE;
    printLog(request, ec);
    return ResponseEntity
        .status(ErrorCode.NOT_READABLE.getHttpStatus())
        .body(ApiResponse.error(ErrorContent.from(ec)));
  }

}
</code></pre><p>HttpServletRequest ì—ì„œ ë‹¤ì‹œ í•œë²ˆ InputStream ì„ ì´ìš©í•˜ì—¬ body ë¥¼ ì½ìœ¼ë ¤ê³  í–ˆì§€ë§Œ ì•„ë¬´ê²ƒë„ ì½ì„ ìˆ˜ ì—†ì—ˆë‹¤.</p><h2 id="httpservletrequest-ì—ì„œ-ê°’ì„-ì½ì„-ë•ŒëŠ”-ë‚´ë¶€ì ìœ¼ë¡œ-inputstream-ì„-ì‚¬ìš©í•œë‹¤">HttpServletRequest ì—ì„œ ê°’ì„ ì½ì„ ë•ŒëŠ” ë‚´ë¶€ì ìœ¼ë¡œ InputStream ì„ ì‚¬ìš©í•œë‹¤.</h2><blockquote><p>The spring-web module contains the HttpMessageConverter interface for reading and writing the body of HTTP requests and responses through InputStream and OutputStream. HttpMessageConverter instances are used on the client side (for concurrency, in the RestClient) and on the server side (for concurrency, in Spring MVC REST controllers).</p></blockquote><p><img src="https://velog.velcdn.com/images/kmss6905/post/bc215933-2cc6-43a4-9a7f-36dc13766dee/image.png" alt="" /></p><p>Spring MVC ëŠ” Servlet API ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤. Spring MVC ì—ì„œëŠ” Dispatcher Servlet ì´ ê·¸ ì—­í• ì„ ë‹´ë‹¹í•˜ê³  ìˆë‹¤. Http ìš”ì²­ì„ ë‹¤ë£° ë•Œ HttpServletRequest ì—ì„œ ìš”ì²­ body ë¥¼ ì½ì„ ë•Œ <code>getInputStream()</code> ê·¸ë¦¬ê³  <code>getReader()</code> ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤. ì´ëŸ¬í•œ ê° ë©”ì†Œë“œëŠ” ë™ì¼í•œ InputStream ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— InputStreamì„ í•œ ë²ˆ ì½ìœ¼ë©´ ë‹¤ì‹œ ì½ì„ ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆë‹¤.</p><h2 id="contentcachingrequestwrapper">ContentCachingRequestWrapper</h2><p><code>ContentCachingRequestWrapper</code> ëŠ” ìƒì„±ìë¡œ ë°›ì€ HttpServeltRequest ë¥¼ input stream ê³¼ reader ë¡œ ë¶€í„° ëª¨ë“  HttpServletRequest ì»¨í…ì¸ ë¥¼ ìºì‹œí•˜ëŠ” HttpServlerRequest Wrapper í´ë˜ìŠ¤ì´ë‹¤.</p><p>ìºì‹œí•œ content ëŠ” byte array í˜•íƒœë¡œ ë‹¤ì‹œ ì–»ì„ ìˆ˜ ìˆë‹¤.</p><p>ì–»ì„ ë•ŒëŠ” <code>getContentAsByteArray()</code> ë¥¼ í†µí•´ ë‹¤ì‹œ ì–»ì„ ìˆ˜ ìˆë‹¤.</p><p>ì¤‘ìš”í•œ ê±´ ìš”ì²­ ì»¨í…ì¸ ê°€ consumed ë˜ì§€ ì•Šì•˜ë‹¤ë©´, ì»¨í…ì¸ ëŠ” ìºì‹œë˜ì§€ ì•ŠëŠ”ë‹¤.</p><pre><code class="language-java">
public class ContentCachingRequestWrapper extends HttpServletRequestWrapper {

private final FastByteArrayOutputStream cachedContent;

public ContentCachingRequestWrapper(HttpServletRequest request) {
		super(request);
		
		// ìºì‹œ í•˜ëŠ” ë¶€ë¶„
		int contentLength = request.getContentLength();
		
		// content ê°€ ìˆëŠ” ê²½ìš° ìºì‹œí•œë‹¤.
		this.cachedContent = (contentLength &gt; 0) ? new FastByteArrayOutputStream(contentLength) : new FastByteArrayOutputStream();
		this.contentCacheLimit = null;
	}
	
	...
	
	// ìºì‹œí•œ ì»¨í…ì¸ ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
	public byte[] getContentAsByteArray() {
		return this.cachedContent.toByteArray();
	}
}
</code></pre><p>ì—„ì²­ íŠ¹ì´í•œ ê±´ ì—†ë‹¤.</p><p>ë‹¤ë§Œ <code>FastByteArrayOutputStream</code> ì´ë¼ê³  í•˜ëŠ” OutputStream ì„ extend í•˜ì—¬ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ë¬¸ì„œì—ì„œëŠ” ByteArrayOutputStream ì˜ ëŒ€ì•ˆìœ¼ë¡œ ë‚˜ì™”ë‹¤ê³  í•œë‹¤.</p><p>ì°¸ê³ ë¡œ <code>AbstractRequestLoggingFilter</code> ì—ì„œë„ ìœ„ì˜ <code>ContentCachingRequestWrapper</code> ê°€ ì‚¬ìš©ëœë‹¤.</p><p><img src="https://velog.velcdn.com/images/kmss6905/post/8eb4fafc-4f37-4855-9bb4-8a8bc838a0d5/image.png" alt="" /></p><h2 id="ì ìš©">ì ìš©</h2><p>Custom Filter ë¥¼ ë§Œë“¤ì–´ ê¸°ì¡´ HttpServletRequest ë¥¼ ìºì‹±í•  ìˆ˜ ìˆë„ë¡ ë“¤ì–´ì˜¨ HttpServletRequest ë¥¼ ì´ìš©í•˜ì—¬ ContentCachingRequestWrapper ê°ì²´ë¥¼ ë§Œë“  í›„ doFilterë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><pre><code class="language-java">@Component
public class CachingFilter extends OncePerRequestFilter {

  @Override
  protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response,
      FilterChain filterChain) throws ServletException, IOException {
    filterChain.doFilter(new ContentCachingRequestWrapper(request), response);
  }
}
</code></pre><h3 id="ì°¸ê³ ">ì°¸ê³ </h3><ul><li>https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-message-conversion</li></ul></div><span class="meta"><time datetime="2024-05-11T00:00:00+09:00">May 11, 2024</time> &middot; </span> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs'; mermaid.initialize({ startOnLoad: true }); </script></section></main></body></html>
